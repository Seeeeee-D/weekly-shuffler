<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button onclick="resultHandler()" id="view-result">結果を見る</button>
    <form id="members-form">
    </form>
    <ol id="result"></ol>
  </body>

  <script>
    // 初期のメンバーリスト
    const members = [
      "Katsuya Suzuki",
      "Ishibashi Ryo",
      "mei",
      "Kaihotsu Kotaro",
      "ryogo_niwa",
      "nanaka",
    ];

    window.onload = () => {
      // フォームの要素を取得
      const formElement = document.getElementById("members-form");
      // メンバーの数だけ以下の処理
      members.forEach((member, i) => {
        const inputGroup = document.createElement("div");
        inputGroup.id = i;
        formElement.appendChild(inputGroup);
        // メンバー名入力フォーム
        const inputElement = document.createElement("input");
        inputElement.value = member;
        // idを付与して後で編集しやすくする
        inputElement.id = "input-" + i;
        inputElement.addEventListener("change", onChangeHandler);
        inputGroup.appendChild(inputElement);

        // メンバーの削除ボタン
        const deleteButtonElement = document.createElement("button");
        deleteButtonElement.innerText = "削除";
        deleteButtonElement.id = "button-" + i;
        deleteButtonElement.type = "button";
        deleteButtonElement.addEventListener("click", deleteButtonHandler);
        inputGroup.appendChild(deleteButtonElement);
      });
    };

    // 入力されたときに呼ばれる関数
    const onChangeHandler = (event) => {
      const member = event.target.value;
      // eventが呼ばれたinputタグのidを検索して要素を上書きする
      const elemId = event.target.id;
      const idx = elemId.replace("input-", "");
      members[idx] = member;
    };

    // 削除ボタンが押されたときに呼ばれる関数
    const deleteButtonHandler = (event) => {
      console.log("onClickHandler");
      const elemId = event.target.id;
      // elemId番目の要素を1つ削除する
      const idx = elemId.replace("button-", "");
      members.splice(idx, 1);
      // 削除ボタンを消す
      document.getElementById(idx).remove()
    };

    // 結果を見るボタンが押されたときに呼ばれる関数
    const resultHandler = () => {
      const resultBox = document.getElementById("result");
      // 結果を空にする
      refreshResultBox(resultBox);
      // メンバーをランダムに入れ替える
      const shuffledMember = shuffle(members);
      // 結果に代入する
      setResult(resultBox, shuffledMember);
    };

    const setResult = (resultBoxElement, shuffledMembers) => {
      // メンバーの名前をli要素に入れる
      shuffledMembers.forEach((member) => {
        const listElement = document.createElement("li");
        listElement.innerText = member;
        resultBoxElement.appendChild(listElement);
      });
    };

    // メンバーをランダムに入れ替える
    const shuffle = (elements) => {
      // メンバーをコピーする
      const copiedElements = [];
      elements.forEach((elem) => {
        copiedElements.push(elem);
      });
      console.log("mem : ", elements);
      const shuffledElements = [];
      // ランダムに取り出して代入していく
      while (copiedElements.length > 0) {
        var num = copiedElements.length;
        var k = Math.floor(Math.random() * num);
        shuffledElements.push(copiedElements[k]);
        copiedElements.splice(k, 1);
      }
      return shuffledElements;
    };

    // 結果を空にする
    const refreshResultBox = (resultBoxElement) => {
      resultBoxElement.innerHTML = "";
    };
  </script>
</html>
